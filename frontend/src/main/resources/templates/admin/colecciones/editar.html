<html th:replace="~{layout/base :: html}">
<div th:fragment="contenido" class="admin-panel-container">
    <div class="admin-panel">
        <div class="content-header">
            <h2 class="content-title">Editar Colecci贸n</h2>
            <a th:href="@{/admin}" class="btn btn-outline">Volver al Panel</a>
        </div>

        <div class="facts-card">
            <div class="card-header">
                <h2 class="card-title" th:text="'Editar: ' + ${coleccion.titulo}">Editar Colecci贸n</h2>
                <p class="card-description">Modifica los detalles de la colecci贸n</p>
            </div>

            <form th:action="@{/admin/colecciones/{handle}/actualizar(handle=${coleccion.handle})}"
                  method="post"
                  th:object="${coleccion}"
                  style="padding: 1.5rem;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- T铆tulo -->
                <div style="margin-bottom: 1.5rem;">
                    <label for="titulo" style="display:block;color:#fff;font-weight:500;margin-bottom:0.5rem;">T铆tulo:</label>
                    <input type="text" id="titulo" name="titulo" th:value="${coleccion.titulo}" required
                           style="width:100%;padding:0.75rem;background-color:#1E2023;border:1px solid #373738;border-radius:0.5rem;color:#fff;font-size:0.875rem;">
                </div>

                <!-- Descripci贸n -->
                <div style="margin-bottom:1.5rem;">
                    <label for="descripcion" style="display:block;color:#fff;font-weight:500;margin-bottom:0.5rem;">Descripci贸n:</label>
                    <textarea id="descripcion" name="descripcion" th:text="${coleccion.descripcion}" rows="4"
                              style="width:100%;padding:0.75rem;background-color:#1E2023;border:1px solid #373738;border-radius:0.5rem;color:#fff;font-size:0.875rem;resize:vertical;"></textarea>
                </div>

                <!-- Algoritmo -->
                <div style="margin-bottom:1.5rem;">
                    <label for="algoritmo" style="display:block;color:#fff;font-weight:500;margin-bottom:0.5rem;">Algoritmo de consenso:</label>
                    <select id="algoritmo" name="algoritmo" th:field="*{algoritmo}"
                            style="width:100%;padding:0.75rem;background-color:#1E2023;border:1px solid #373738;border-radius:0.5rem;color:#fff;font-size:0.875rem;cursor:pointer;">
                        <option value="MAYORIA_SIMPLE">Mayor铆a simple</option>
                        <option value="MAYORIA_ABSOLUTA">Mayor铆a absoluta</option>
                        <option value="MULTIPLES_MENCIONES">M煤ltiples menciones</option>
                    </select>
                </div>

                <!--  Fuentes con Dual Listbox Scoped -->
                <div id="dualbox-bootstrap" style="margin-bottom:2rem;">
                    <div id="fuentesDualContainer">
                        <h3 style="color:#fff;font-size:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 style="width:1.2rem;height:1.2rem;">
                                <path d="M4 19h16M4 15h16M4 11h16M4 7h16"/>
                            </svg>
                            Fuentes de la colecci贸n
                        </h3>

                        <select multiple="multiple" size="10"
                                th:field="*{fuentesIds}"
                                id="fuentesDual">
                            <option th:each="fuente : ${todasLasFuentes}"
                                    th:value="${fuente.id}"
                                    th:text="${fuente.nombre}"
                                    th:selected="${coleccion.fuentesIds.contains(fuente.id)}">
                            </option>
                        </select>

                        <p style="color:#aaa;font-size:0.8rem;margin-top:0.75rem;">
                            Mueve las fuentes entre las listas para agregarlas o quitarlas de la colecci贸n.
                        </p>
                    </div>
                </div>

                <!-- Botones -->
                <div class="collection-actions" style="margin-top:2rem;display:flex;gap:1rem;">
                    <button type="submit" class="btn btn-success">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Guardar Cambios
                    </button>
                    <a th:href="@{/admin}" class="btn btn-outline">Cancelar</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Scoped CSS y JS para Dual Listbox -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap4-duallistbox/dist/bootstrap-duallistbox.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap4-duallistbox/dist/jquery.bootstrap-duallistbox.min.js"></script>

    <style>
        /* Contenedor principal */
        #fuentesDualContainer {
            background-color: #1A1C1F;
            border: 1px solid #2C2F33;
            border-radius: 0.75rem;
            padding: 1.25rem;
        }

        /* Dual Listbox layout */
        #dualbox-bootstrap .bootstrap-duallistbox-container {
            display: flex;
            gap: 1rem;
            width: 100%;
        }

        /* Columnas */
        #dualbox-bootstrap .box1,
        #dualbox-bootstrap .box2 {
            flex: 1;
            background-color: #2C2F33;
            border: 1px solid #444;
            color: #fff;
            border-radius: 0.5rem;
        }

        /* Filtros */
        #dualbox-bootstrap .filter {
            background-color: #1E2023;
            border: 1px solid #444;
            color: #fff;
            border-radius: 0.5rem;
        }

        /* Botones */
        #dualbox-bootstrap .move,
        #dualbox-bootstrap .remove,
        #dualbox-bootstrap .moveall,
        #dualbox-bootstrap .removeall {
            background-color: #3A3F44;
            border: 1px solid #555;
            color: #fff;
            border-radius: 0.5rem;
            margin: 3px 0;
            width: 3rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #dualbox-bootstrap .move:hover,
        #dualbox-bootstrap .remove:hover,
        #dualbox-bootstrap .moveall:hover,
        #dualbox-bootstrap .removeall:hover {
            background-color: #5A6168;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Inicializamos Dual Listbox solo dentro de #dualbox-bootstrap
            $('#dualbox-bootstrap #fuentesDual').bootstrapDualListbox({
                nonSelectedListLabel: 'Fuentes disponibles',
                selectedListLabel: 'Fuentes en la colecci贸n',
                preserveSelectionOnMove: 'moved',
                moveOnSelect: false,
                infoText: 'Mostrando {0} fuentes',
                infoTextEmpty: 'Sin fuentes',
                filterPlaceHolder: 'Buscar...',
                filterTextClear: 'Mostrar todas'
            });
        });
    </script>
</div>
</html>
